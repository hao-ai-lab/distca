$ NVTE_ALLOW_NONDETERMINISTIC_ALGO=0 torchrun --nnodes 1 --nproc_per_node 4 test_dispatch_fast_balanced_flops.py     --world-size 4

W0805 08:57:40.458000 1669394 torch/distributed/run.py:766]
W0805 08:57:40.458000 1669394 torch/distributed/run.py:766] *****************************************
W0805 08:57:40.458000 1669394 torch/distributed/run.py:766] Setting OMP_NUM_THREADS environment variable for each process to be 1 in default, to avoid your system being overloaded, please further tune the variable for optimal performance in your application as needed.
W0805 08:57:40.458000 1669394 torch/distributed/run.py:766] *****************************************
Testing /workspace/d2/tests/test_dispatch_fast_balanced_flops.py with args = Namespace(world_size=4, num_tokens=16384, max_cp_degree=6, hidden_size_query=64, hidden_size_kv=16, num_seqs=8, seed=0)
Testing /workspace/d2/tests/test_dispatch_fast_balanced_flops.py with args = Namespace(world_size=4, num_tokens=16384, max_cp_degree=6, hidden_size_query=64, hidden_size_kv=16, num_seqs=8, seed=0)
This test currently deadlocked...
This test currently deadlocked...
Testing /workspace/d2/tests/test_dispatch_fast_balanced_flops.py with args = Namespace(world_size=4, num_tokens=16384, max_cp_degree=6, hidden_size_query=64, hidden_size_kv=16, num_seqs=8, seed=0)
This test currently deadlocked...
Testing /workspace/d2/tests/test_dispatch_fast_balanced_flops.py with args = Namespace(world_size=4, num_tokens=16384, max_cp_degree=6, hidden_size_query=64, hidden_size_kv=16, num_seqs=8, seed=0)
This test currently deadlocked...
NVSHMEM v3.2.5
init done.
init done.init done.init done.


Namespace(world_size=4, num_tokens=16384, max_cp_degree=6, hidden_size_query=64, hidden_size_kv=16, num_seqs=8, seed=0)
seq_lens = tensor([[16384,     0,     0,     0,     0,     0,     0,     0],
        [ 8192,  8192,     0,     0,     0,     0,     0,     0],
        [ 4096,  4096,  4096,  4096,     0,     0,     0,     0],
        [ 2048,  2048,  2048,  2048,  2048,  2048,  2048,  2048]])
cp_num = tensor([[6, 0, 0, 0, 0, 0, 0, 0],
        [1, 1, 0, 0, 0, 0, 0, 0],
        [1, 1, 1, 1, 0, 0, 0, 0],
        [1, 1, 1, 1, 1, 1, 1, 1]])
seq_lens = tensor([[16384,     0,     0,     0,     0,     0,     0,     0],
        [ 8192,  8192,     0,     0,     0,     0,     0,     0],
        [ 4096,  4096,  4096,  4096,     0,     0,     0,     0],
        [ 2048,  2048,  2048,  2048,  2048,  2048,  2048,  2048]])
cp_dst = tensor([[[ 0,  2,  3,  3,  2,  0],
         [-1, -1, -1, -1, -1, -1],
         [-1, -1, -1, -1, -1, -1],
         [-1, -1, -1, -1, -1, -1],
         [-1, -1, -1, -1, -1, -1],
         [-1, -1, -1, -1, -1, -1],
         [-1, -1, -1, -1, -1, -1],
         [-1, -1, -1, -1, -1, -1]],

        [[ 1, -1, -1, -1, -1, -1],
         [ 1, -1, -1, -1, -1, -1],
         [-1, -1, -1, -1, -1, -1],
         [-1, -1, -1, -1, -1, -1],
         [-1, -1, -1, -1, -1, -1],
         [-1, -1, -1, -1, -1, -1],
         [-1, -1, -1, -1, -1, -1],
         [-1, -1, -1, -1, -1, -1]],

        [[ 2, -1, -1, -1, -1, -1],
         [ 2, -1, -1, -1, -1, -1],
         [ 2, -1, -1, -1, -1, -1],
         [ 2, -1, -1, -1, -1, -1],
         [-1, -1, -1, -1, -1, -1],
         [-1, -1, -1, -1, -1, -1],
         [-1, -1, -1, -1, -1, -1],
         [-1, -1, -1, -1, -1, -1]],

        [[ 3, -1, -1, -1, -1, -1],
         [ 3, -1, -1, -1, -1, -1],
         [ 3, -1, -1, -1, -1, -1],
         [ 3, -1, -1, -1, -1, -1],
         [ 3, -1, -1, -1, -1, -1],
         [ 3, -1, -1, -1, -1, -1],
         [ 3, -1, -1, -1, -1, -1],
         [ 3, -1, -1, -1, -1, -1]]])
seq_shard_lens = tensor([[[3754, 1706, 2730, 2734, 1706, 3754],
         [   0,    0,    0,    0,    0,    0],
         [   0,    0,    0,    0,    0,    0],
         [   0,    0,    0,    0,    0,    0],
         [   0,    0,    0,    0,    0,    0],
         [   0,    0,    0,    0,    0,    0],
         [   0,    0,    0,    0,    0,    0],
         [   0,    0,    0,    0,    0,    0]],

        [[8192,    0,    0,    0,    0,    0],
         [8192,    0,    0,    0,    0,    0],
         [   0,    0,    0,    0,    0,    0],
         [   0,    0,    0,    0,    0,    0],
         [   0,    0,    0,    0,    0,    0],
         [   0,    0,    0,    0,    0,    0],
         [   0,    0,    0,    0,    0,    0],
         [   0,    0,    0,    0,    0,    0]],

        [[4096,    0,    0,    0,    0,    0],
         [4096,    0,    0,    0,    0,    0],
         [4096,    0,    0,    0,    0,    0],
         [4096,    0,    0,    0,    0,    0],
         [   0,    0,    0,    0,    0,    0],
         [   0,    0,    0,    0,    0,    0],
         [   0,    0,    0,    0,    0,    0],
         [   0,    0,    0,    0,    0,    0]],

        [[2048,    0,    0,    0,    0,    0],
         [2048,    0,    0,    0,    0,    0],
         [2048,    0,    0,    0,    0,    0],
         [2048,    0,    0,    0,    0,    0],
         [2048,    0,    0,    0,    0,    0],
         [2048,    0,    0,    0,    0,    0],
         [2048,    0,    0,    0,    0,    0],
         [2048,    0,    0,    0,    0,    0]]])
num_cp_shards = tensor([6, 2, 4, 8])
num_cul_cp_shards = tensor([[0, 6, 6, 6, 6, 6, 6, 6],
        [0, 1, 2, 2, 2, 2, 2, 2],
        [0, 1, 2, 3, 4, 4, 4, 4],
        [0, 1, 2, 3, 4, 5, 6, 7]])
cp_seq_lens = tensor([[3754, 1706, 2730, 2734, 1706, 3754,    0,    0],
        [8192, 8192,    0,    0,    0,    0,    0,    0],
        [4096, 4096, 4096, 4096,    0,    0,    0,    0],
        [2048, 2048, 2048, 2048, 2048, 2048, 2048, 2048]])
cp_query_dst = tensor([[ 0,  2,  3,  3,  2,  0, -1, -1],
        [ 1,  1, -1, -1, -1, -1, -1, -1],
        [ 2,  2,  2,  2, -1, -1, -1, -1],
        [ 3,  3,  3,  3,  3,  3,  3,  3]])
kv_to_q_mapping = tensor([[[[ 0,  0],
          [ 0,  1],
          [ 0,  2],
          [ 0,  3],
          [ 0,  4],
          [ 0,  5]],

         [[ 0,  1],
          [ 0,  2],
          [ 0,  3],
          [ 0,  4],
          [ 0,  5],
          [-1, -1]],

         [[ 0,  2],
          [ 0,  3],
          [ 0,  4],
          [ 0,  5],
          [-1, -1],
          [-1, -1]],

         [[ 0,  3],
          [ 0,  4],
          [ 0,  5],
          [-1, -1],
          [-1, -1],
          [-1, -1]],

         [[ 0,  4],
          [ 0,  5],
          [-1, -1],
          [-1, -1],
          [-1, -1],
          [-1, -1]],

         [[ 0,  5],
          [-1, -1],
          [-1, -1],
          [-1, -1],
          [-1, -1],
          [-1, -1]],

         [[-1, -1],
          [-1, -1],
          [-1, -1],
          [-1, -1],
          [-1, -1],
          [-1, -1]],

         [[-1, -1],
          [-1, -1],
          [-1, -1],
          [-1, -1],
          [-1, -1],
          [-1, -1]]],


        [[[ 1,  0],
          [-1, -1],
          [-1, -1],
          [-1, -1],
          [-1, -1],
          [-1, -1]],

         [[ 1,  1],
          [-1, -1],
          [-1, -1],
          [-1, -1],
          [-1, -1],
          [-1, -1]],

         [[-1, -1],
          [-1, -1],
          [-1, -1],
          [-1, -1],
          [-1, -1],
          [-1, -1]],

         [[-1, -1],
          [-1, -1],
          [-1, -1],
          [-1, -1],
          [-1, -1],
          [-1, -1]],

         [[-1, -1],
          [-1, -1],
          [-1, -1],
          [-1, -1],
          [-1, -1],
          [-1, -1]],

         [[-1, -1],
          [-1, -1],
          [-1, -1],
          [-1, -1],
          [-1, -1],
          [-1, -1]],

         [[-1, -1],
          [-1, -1],
          [-1, -1],
          [-1, -1],
          [-1, -1],
          [-1, -1]],

         [[-1, -1],
          [-1, -1],
          [-1, -1],
          [-1, -1],
          [-1, -1],
          [-1, -1]]],


        [[[ 2,  0],
          [-1, -1],
          [-1, -1],
          [-1, -1],
          [-1, -1],
          [-1, -1]],

         [[ 2,  1],
          [-1, -1],
          [-1, -1],
          [-1, -1],
          [-1, -1],
          [-1, -1]],

         [[ 2,  2],
          [-1, -1],
          [-1, -1],
          [-1, -1],
          [-1, -1],
          [-1, -1]],

         [[ 2,  3],
          [-1, -1],
          [-1, -1],
          [-1, -1],
          [-1, -1],
          [-1, -1]],

         [[-1, -1],
          [-1, -1],
          [-1, -1],
          [-1, -1],
          [-1, -1],
          [-1, -1]],

         [[-1, -1],
          [-1, -1],
          [-1, -1],
          [-1, -1],
          [-1, -1],
          [-1, -1]],

         [[-1, -1],
          [-1, -1],
          [-1, -1],
          [-1, -1],
          [-1, -1],
          [-1, -1]],

         [[-1, -1],
          [-1, -1],
          [-1, -1],
          [-1, -1],
          [-1, -1],
          [-1, -1]]],


        [[[ 3,  0],
          [-1, -1],
          [-1, -1],
          [-1, -1],
          [-1, -1],
          [-1, -1]],

         [[ 3,  1],
          [-1, -1],
          [-1, -1],
          [-1, -1],
          [-1, -1],
          [-1, -1]],

         [[ 3,  2],
          [-1, -1],
          [-1, -1],
          [-1, -1],
          [-1, -1],
          [-1, -1]],

         [[ 3,  3],
          [-1, -1],
          [-1, -1],
          [-1, -1],
          [-1, -1],
          [-1, -1]],

         [[ 3,  4],
          [-1, -1],
          [-1, -1],
          [-1, -1],
          [-1, -1],
          [-1, -1]],

         [[ 3,  5],
          [-1, -1],
          [-1, -1],
          [-1, -1],
          [-1, -1],
          [-1, -1]],

         [[ 3,  6],
          [-1, -1],
          [-1, -1],
          [-1, -1],
          [-1, -1],
          [-1, -1]],

         [[ 3,  7],
          [-1, -1],
          [-1, -1],
          [-1, -1],
          [-1, -1],
          [-1, -1]]]])
kv_to_q_rank = tensor([[[ 0,  0,  0,  0,  0,  0],
         [ 1,  1,  1,  1,  1, -1],
         [ 2,  2,  2,  2, -1, -1],
         [ 3,  3,  3, -1, -1, -1],
         [ 4,  4, -1, -1, -1, -1],
         [ 5, -1, -1, -1, -1, -1],
         [-1, -1, -1, -1, -1, -1],
         [-1, -1, -1, -1, -1, -1]],

        [[ 0, -1, -1, -1, -1, -1],
         [ 0, -1, -1, -1, -1, -1],
         [-1, -1, -1, -1, -1, -1],
         [-1, -1, -1, -1, -1, -1],
         [-1, -1, -1, -1, -1, -1],
         [-1, -1, -1, -1, -1, -1],
         [-1, -1, -1, -1, -1, -1],
         [-1, -1, -1, -1, -1, -1]],

        [[ 0, -1, -1, -1, -1, -1],
         [ 0, -1, -1, -1, -1, -1],
         [ 0, -1, -1, -1, -1, -1],
         [ 0, -1, -1, -1, -1, -1],
         [-1, -1, -1, -1, -1, -1],
         [-1, -1, -1, -1, -1, -1],
         [-1, -1, -1, -1, -1, -1],
         [-1, -1, -1, -1, -1, -1]],

        [[ 0, -1, -1, -1, -1, -1],
         [ 0, -1, -1, -1, -1, -1],
         [ 0, -1, -1, -1, -1, -1],
         [ 0, -1, -1, -1, -1, -1],
         [ 0, -1, -1, -1, -1, -1],
         [ 0, -1, -1, -1, -1, -1],
         [ 0, -1, -1, -1, -1, -1],
         [ 0, -1, -1, -1, -1, -1]]])
kv_context_size = tensor([[    0,  3754,  5460,  8190, 10924, 12630,     0,     0],
        [    0,     0,     0,     0,     0,     0,     0,     0],
        [    0,     0,     0,     0,     0,     0,     0,     0],
        [    0,     0,     0,     0,     0,     0,     0,     0]])
q_to_num_kv_seq = tensor([[1, 2, 3, 4, 5, 6, 0, 0],
        [1, 1, 0, 0, 0, 0, 0, 0],
        [1, 1, 1, 1, 0, 0, 0, 0],
        [1, 1, 1, 1, 1, 1, 1, 1]])
q_to_num_kv_tokens = tensor([[ 3754,  5460,  8190, 10924, 12630, 16384,     0,     0],
        [ 8192,  8192,     0,     0,     0,     0,     0,     0],
        [ 4096,  4096,  4096,  4096,     0,     0,     0,     0],
        [ 2048,  2048,  2048,  2048,  2048,  2048,  2048,  2048]])
fwd_q_metadata =
Metadata(
    dst_rank=tensor([[ 0,  2,  3,  3,  2,  0, -1, -1],
        [ 1,  1, -1, -1, -1, -1, -1, -1],
        [ 2,  2,  2,  2, -1, -1, -1, -1],
        [ 3,  3,  3,  3,  3,  3,  3,  3]]),
    dst_offset=tensor([[    0,     0,     0,  2730,  1706,  3754,     0,     0],
        [    0,  8192,     0,     0,     0,     0,     0,     0],
        [ 3412,  7508, 11604, 15700,     0,     0,     0,     0],
        [ 5464,  7512,  9560, 11608, 13656, 15704, 17752, 19800]]),
    seq_len=tensor([[3754, 1706, 2730, 2734, 1706, 3754,    0,    0],
        [8192, 8192,    0,    0,    0,    0,    0,    0],
        [4096, 4096, 4096, 4096,    0,    0,    0,    0],
        [2048, 2048, 2048, 2048, 2048, 2048, 2048, 2048]]),
    num_recv_tokens=tensor([[ 7508,     0,     0,     0,  7508],
        [    0, 16384,     0,     0, 16384],
        [ 3412,     0, 16384,     0, 19796],
        [ 5464,     0,     0, 16384, 21848]]),
    seq_recv_mask=None,
    recv_seq_lens=None,
    num_seqs=tensor([6, 2, 4, 8]),
    world_size=4,
    normalized=False,
    num_total_recv_tokens=[7508, 16384, 19796, 21848]
)
rev_q_metadata =
Metadata(
    dst_rank=tensor([[ 0,  0, -1, -1, -1, -1, -1, -1, -1, -1],
        [ 1,  1, -1, -1, -1, -1, -1, -1, -1, -1],
        [ 0,  0,  2,  2,  2,  2, -1, -1, -1, -1],
        [ 0,  0,  3,  3,  3,  3,  3,  3,  3,  3]]),
    dst_offset=tensor([[    0, 12630,     0,     0,     0,     0,     0,     0,     0,     0],
        [    0,  8192,     0,     0,     0,     0,     0,     0,     0,     0],
        [ 3754, 10924,     0,  4096,  8192, 12288,     0,     0,     0,     0],
        [ 5460,  8190,     0,  2048,  4096,  6144,  8192, 10240, 12288, 14336]]),
    seq_len=tensor([[3754, 3754,    0,    0,    0,    0,    0,    0,    0,    0],
        [8192, 8192,    0,    0,    0,    0,    0,    0,    0,    0],
        [1706, 1706, 4096, 4096, 4096, 4096,    0,    0,    0,    0],
        [2730, 2734, 2048, 2048, 2048, 2048, 2048, 2048, 2048, 2048]]),
    num_recv_tokens=tensor([[ 7508,     0,  3412,  5464, 16384],
        [    0, 16384,     0,     0, 16384],
        [    0,     0, 16384,     0, 16384],
        [    0,     0,     0, 16384, 16384]]),
    seq_recv_mask=None,
    recv_seq_lens=None,
    num_seqs=tensor([ 2,  2,  6, 10]),
    world_size=4,
    normalized=False,
    num_total_recv_tokens=[16384, 16384, 16384, 16384]
)
fwd_k_metadata =
Metadata(
    dst_rank=tensor([[[ 0,  2,  3,  3,  2,  0],
         [ 2,  3,  3,  2,  0, -1],
         [ 3,  3,  2,  0, -1, -1],
         [ 3,  2,  0, -1, -1, -1],
         [ 2,  0, -1, -1, -1, -1],
         [ 0, -1, -1, -1, -1, -1],
         [-1, -1, -1, -1, -1, -1],
         [-1, -1, -1, -1, -1, -1]],

        [[ 1, -1, -1, -1, -1, -1],
         [ 1, -1, -1, -1, -1, -1],
         [-1, -1, -1, -1, -1, -1],
         [-1, -1, -1, -1, -1, -1],
         [-1, -1, -1, -1, -1, -1],
         [-1, -1, -1, -1, -1, -1],
         [-1, -1, -1, -1, -1, -1],
         [-1, -1, -1, -1, -1, -1]],

        [[ 2, -1, -1, -1, -1, -1],
         [ 2, -1, -1, -1, -1, -1],
         [ 2, -1, -1, -1, -1, -1],
         [ 2, -1, -1, -1, -1, -1],
         [-1, -1, -1, -1, -1, -1],
         [-1, -1, -1, -1, -1, -1],
         [-1, -1, -1, -1, -1, -1],
         [-1, -1, -1, -1, -1, -1]],

        [[ 3, -1, -1, -1, -1, -1],
         [ 3, -1, -1, -1, -1, -1],
         [ 3, -1, -1, -1, -1, -1],
         [ 3, -1, -1, -1, -1, -1],
         [ 3, -1, -1, -1, -1, -1],
         [ 3, -1, -1, -1, -1, -1],
         [ 3, -1, -1, -1, -1, -1],
         [ 3, -1, -1, -1, -1, -1]]]),
    dst_offset=tensor([[[    0,     0,     0,  8190,  5460,  3754],
         [ 3754,  3754, 11944,  9214,  7508,     0],
         [ 5460, 13650, 10920,  9214,     0,     0],
         [16380, 13650, 11944,     0,     0,     0],
         [16384, 14678,     0,     0,     0,     0],
         [16384,     0,     0,     0,     0,     0],
         [    0,     0,     0,     0,     0,     0],
         [    0,     0,     0,     0,     0,     0]],

        [[    0,     0,     0,     0,     0,     0],
         [ 8192,     0,     0,     0,     0,     0],
         [    0,     0,     0,     0,     0,     0],
         [    0,     0,     0,     0,     0,     0],
         [    0,     0,     0,     0,     0,     0],
         [    0,     0,     0,     0,     0,     0],
         [    0,     0,     0,     0,     0,     0],
         [    0,     0,     0,     0,     0,     0]],

        [[18090,     0,     0,     0,     0,     0],
         [22186,     0,     0,     0,     0,     0],
         [26282,     0,     0,     0,     0,     0],
         [30378,     0,     0,     0,     0,     0],
         [    0,     0,     0,     0,     0,     0],
         [    0,     0,     0,     0,     0,     0],
         [    0,     0,     0,     0,     0,     0],
         [    0,     0,     0,     0,     0,     0]],

        [[19114,     0,     0,     0,     0,     0],
         [21162,     0,     0,     0,     0,     0],
         [23210,     0,     0,     0,     0,     0],
         [25258,     0,     0,     0,     0,     0],
         [27306,     0,     0,     0,     0,     0],
         [29354,     0,     0,     0,     0,     0],
         [31402,     0,     0,     0,     0,     0],
         [33450,     0,     0,     0,     0,     0]]]),
    seq_len=tensor([[3754, 1706, 2730, 2734, 1706, 3754,    0,    0],
        [8192, 8192,    0,    0,    0,    0,    0,    0],
        [4096, 4096, 4096, 4096,    0,    0,    0,    0],
        [2048, 2048, 2048, 2048, 2048, 2048, 2048, 2048]]),
    num_recv_tokens=tensor([[20138,     0,     0,     0, 20138],
        [    0, 16384,     0,     0, 16384],
        [18090,     0, 16384,     0, 34474],
        [19114,     0,     0, 16384, 35498]]),
    seq_recv_mask=None,
    recv_seq_lens=None,
    num_seqs=tensor([6, 2, 4, 8]),
    world_size=4,
    normalized=False,
    num_total_recv_tokens=[20138, 16384, 34474, 35498]
)
rev_k_metadata =
Metadata(
    dst_rank=tensor([[ 0,  0,  0,  0,  0,  0,  0, -1, -1, -1, -1, -1, -1, -1, -1],
        [ 1,  1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1],
        [ 0,  0,  0,  0,  0,  0,  0,  2,  2,  2,  2, -1, -1, -1, -1],
        [ 0,  0,  0,  0,  0,  0,  0,  3,  3,  3,  3,  3,  3,  3,  3]]),
    dst_offset=tensor([[    0, 81920, 69290, 54612, 40958, 27308, 12630,     0,     0,     0,
             0,     0,     0,     0,     0],
        [    0,  8192,     0,     0,     0,     0,     0,     0,     0,     0,
             0,     0,     0,     0,     0],
        [16384,  3754, 65536, 52906, 38228, 24574, 10924,     0,  4096,  8192,
         12288,     0,     0,     0,     0],
        [32768, 20138,  5460, 49152, 36522, 21844,  8190,     0,  2048,  4096,
          6144,  8192, 10240, 12288, 14336]]),
    seq_len=tensor([[3754, 3754, 1706, 2730, 2734, 1706, 3754,    0,    0,    0,    0,    0,
            0,    0,    0],
        [8192, 8192,    0,    0,    0,    0,    0,    0,    0,    0,    0,    0,
            0,    0,    0],
        [3754, 1706, 3754, 1706, 2730, 2734, 1706, 4096, 4096, 4096, 4096,    0,
            0,    0,    0],
        [3754, 1706, 2730, 3754, 1706, 2730, 2734, 2048, 2048, 2048, 2048, 2048,
         2048, 2048, 2048]]),
    num_recv_tokens=tensor([[20138,     0, 18090, 19114, 57342],
        [    0, 16384,     0,     0, 16384],
        [    0,     0, 16384,     0, 16384],
        [    0,     0,     0, 16384, 16384]]),
    seq_recv_mask=tensor([[[ True,  True,  True,  True,  True,  True],
         [ True,  True,  True,  True,  True, False],
         [ True,  True,  True,  True, False, False],
         [ True,  True,  True, False, False, False],
         [ True,  True, False, False, False, False],
         [ True, False, False, False, False, False],
         [False, False, False, False, False, False],
         [False, False, False, False, False, False]],

        [[ True, False, False, False, False, False],
         [ True, False, False, False, False, False],
         [False, False, False, False, False, False],
         [False, False, False, False, False, False],
         [False, False, False, False, False, False],
         [False, False, False, False, False, False],
         [False, False, False, False, False, False],
         [False, False, False, False, False, False]],

        [[ True, False, False, False, False, False],
         [ True, False, False, False, False, False],
         [ True, False, False, False, False, False],
         [ True, False, False, False, False, False],
         [False, False, False, False, False, False],
         [False, False, False, False, False, False],
         [False, False, False, False, False, False],
         [False, False, False, False, False, False]],

        [[ True, False, False, False, False, False],
         [ True, False, False, False, False, False],
         [ True, False, False, False, False, False],
         [ True, False, False, False, False, False],
         [ True, False, False, False, False, False],
         [ True, False, False, False, False, False],
         [ True, False, False, False, False, False],
         [ True, False, False, False, False, False]]]),
    recv_seq_lens=tensor([[3754, 1706, 2730, 2734, 1706, 3754,    0,    0],
        [8192, 8192,    0,    0,    0,    0,    0,    0],
        [4096, 4096, 4096, 4096,    0,    0,    0,    0],
        [2048, 2048, 2048, 2048, 2048, 2048, 2048, 2048]]),
    num_seqs=tensor([ 7,  2, 11, 15]),
    world_size=4,
    normalized=False,
    num_total_recv_tokens=[57342, 16384, 16384, 16384]
)
attention_metadata =
(
    (
        tensor([   0, 3754, 7508, 7508, 7508, 7508, 7508, 7508]),
        tensor([    0,  8192, 16384, 16384, 16384, 16384, 16384, 16384, 16384]),
        tensor([    0,  1706,  3412,  7508, 11604, 15700, 19796, 19796, 19796, 19796]),
        tensor([    0,  2730,  5464,  7512,  9560, 11608, 13656, 15704, 17752, 19800,
        21848])
    ),
    (
        tensor([    0,  3754, 20138, 20138, 20138, 20138, 20138, 20138]),
        tensor([    0,  8192, 16384, 16384, 16384, 16384, 16384, 16384, 16384]),
        tensor([    0,  5460, 18090, 22186, 26282, 30378, 34474, 34474, 34474, 34474]),
        tensor([    0,  8190, 19114, 21162, 23210, 25258, 27306, 29354, 31402, 33450,
        35498])
    ),
    tensor([3754, 8192, 4096, 2734]),
    tensor([16384,  8192, 12630, 10924]),
    tensor([ 7,  8,  9, 10])
)
metadata compute done.
metadata compute done.
metadata compute done.
metadata compute done.

(deadlocked...?)